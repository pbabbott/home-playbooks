# TODO: update mealie_data path to be a variable

- ansible.builtin.file:
    path: /home/pi/mealie_data
    state: directory
    mode: '0755'  
- community.docker.docker_compose:
    project_name: mealie
    
    definition:
      version: "3.1"
      networks:
        default:
          name: lsio
          external: true
      services:
        mealie:
          container_name: mealie
          image: hkotel/mealie:latest
          restart: always
          ports:
            - 9925:80
          environment:
            PUID: "{{ host_puid }}"
            PGID: "{{ host_pgid }}"
            TZ: "{{ host_tz }}"

            # Default Recipe Settings
            RECIPE_PUBLIC: 'true'
            RECIPE_SHOW_NUTRITION: 'true'
            RECIPE_SHOW_ASSETS: 'true'
            RECIPE_LANDSCAPE_VIEW: 'true'
            RECIPE_DISABLE_COMMENTS: 'false'
            RECIPE_DISABLE_AMOUNT: 'false'

            # Gunicorn
            # WEB_CONCURRENCY: 2
            # WORKERS_PER_CORE: 0.5
            # MAX_WORKERS: 8
          volumes:
            - /home/pi/mealie_data/:/app/data